{"version":3,"sources":["utils/user.ts","components/id-select.tsx","components/user-select.tsx","screens/project-list/search-panel.tsx","components/pin.tsx","utils/reorder.ts","utils/use-optimistic-options.ts","utils/project.ts","utils/url.ts","screens/project-list/util.ts","screens/project-list/list.tsx","components/profiler.tsx","screens/project-list/index.tsx","assets/software-logo.svg","utils/epic.ts","utils/task.ts","screens/kanban/util.ts","screens/epic/util.ts","screens/epic/create-epic.tsx","screens/epic/index.tsx","components/drag-and-drop.tsx","utils/kanban.ts","assets/task.svg","assets/bug.svg","utils/task-type.ts","screens/kanban/create-task.tsx","components/mark.tsx","screens/kanban/kanban-column.tsx","screens/kanban/create-kanban.tsx","components/task-type-select.tsx","screens/kanban/search-panel.tsx","components/epic-select.tsx","screens/kanban/task-modal.tsx","screens/kanban/index.tsx","screens/project/index.tsx","screens/project-list/project-modal.tsx","components/project-popover.tsx","components/user-popover.tsx","authenticated-app.tsx"],"names":["useUsers","param","client","useHttp","useQuery","data","IdSelect","props","value","onChange","defaultOptionName","options","restProps","length","toNumber","undefined","Option","map","option","id","name","isNaN","Number","UserSelect","users","SearchPanel","setParam","style","marginBottom","layout","Item","placeholder","type","evt","target","personId","Pin","checked","onCheckedChange","count","num","reorder","fromId","referenceId","list","copiedList","movingItemIndex","findIndex","item","insertAfter","targetIndex","insertBefore","from","to","toItem","removedItem","splice","toIndex","indexOf","useConfig","queryKey","callback","queryClient","useQueryClient","onSuccess","invalidateQueries","onMutate","previousItems","getQueryData","setQueryData","old","onError","error","newItem","context","useDeleteConfig","filter","useEditConfig","useAddConfig","useProjects","cleanObject","useEditProject","useMutation","params","method","useAddProject","useProject","enabled","Boolean","useUrlQueryParam","keys","useSearchParams","searchParams","setSearchParams","useSetUrlSearchParam","useState","stateKeys","useMemo","subset","Object","fromEntries","setSearchParam","o","useProjectsSearchParams","useProjectsQueryKey","useProjectModal","projectCreate","setProjectCreate","editingProjectId","setEditingProjectId","setUrlParams","editingProject","isLoading","projectModalOpen","open","close","startEdit","List","mutate","rowKey","pagination","columns","title","disabled","render","project","pin","sorter","a","b","localeCompare","String","dataIndex","find","user","created","dayjs","format","More","deleteProject","useDeleteProject","overlay","onClick","Modal","confirm","content","okText","cancelText","onOk","confirmDeleteProject","queue","setInterval","queueToSend","console","log","Profiler","metadata","phases","onRender","phase","actualDuration","baseDuration","startTime","commitTime","interactions","includes","push","ProjectListScreen","useDocumentTitle","useDebounce","between","loading","dataSource","_extends","assign","i","arguments","source","key","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","whyDidYouRender","x1","y1","x2","y2","stopColor","offset","stroke","strokeWidth","fillRule","d","fill","SvgSoftwareLogo","_ref","svgRef","titleId","viewBox","xmlns","focusable","className","ref","ForwardRef","useEpics","useTasks","useReorderTask","kanbanId","toKanbanId","useReorderTaskConfig","useProjectIdInUrl","useLocation","pathname","match","useProjectInUrl","useKanbanSearchParams","projectId","useKanbansQueryKey","useTasksSearchParams","debouncedName","typeId","processorId","tagId","useTasksQueryKey","useTasksModal","editingTaskId","setEditingTaskId","useTask","editingTask","useCallback","useEpicSearchParams","useEpicsQueryKey","CreateEpic","useAddEpic","addEpic","Form","useForm","form","onFinish","values","onClose","useEffect","resetFields","visible","forceRender","destroyOnClose","width","Container","size","label","rules","required","message","textAlign","htmlType","styled","div","EpicScreen","currentProject","epics","tasks","deleteEpic","useDeleteEpic","epicCreateOpen","setEpicCreateOpen","overflow","itemLayout","renderItem","epic","Meta","confirmDeleteEpic","description","start","end","task","epicId","Drop","children","provided","React","isValidElement","cloneElement","droppableProps","innerRef","DropChild","forwardRef","Drag","draggableProps","dragHandleProps","useKanbans","useReorderKanban","useReorderKanbanConfig","useTaskTypes","CreateTask","setName","addTask","useAddTask","mutateAsync","inputMode","setInputMode","submit","toggle","mode","onBlur","autoFocus","onPressEnter","Mark","keyword","arr","split","str","index","color","TaskTypeIcon","taskTypes","taskType","alt","src","taskIcon","bugIcon","TaskCard","cursor","KanbanColumn","kanban","allTasks","TasksContainer","direction","droppableId","minHeight","taskIndex","draggableId","useDeleteKanban","CreateKanban","addKanban","useAddKanban","TaskTypeSelect","gap","EpicSelect","labelCol","span","wrapperCol","TaskModal","useEditTask","editTask","editLoading","deleteTask","useDeleteTask","getFieldsValue","setFieldsValue","onCancel","confirmLoading","initialValues","fontSize","KanbanScreen","kanbans","kanbanIsLoading","onDragEnd","useDragEnd","ColumnsContainer","display","reorderKanban","reorderTask","destination","toId","fromKanbanId","fromTask","toTask","ProjectScreen","routeType","units","useRouteType","Aside","selectedKeys","Main","path","element","window","location","replace","aside","ProjectModal","mutateLoading","then","ProjectPopover","projects","refetch","pinnedProjects","ContentContainer","Text","onVisibleChange","placement","UserPopover","AuthenticatedApp","PageHeader","Header","HeaderLeft","resetRoute","HeaderRight","User","useAuth","logout","e","preventDefault","Row","main"],"mappings":"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","file":"static/js/5.ec8a9271.chunk.js","sourcesContent":["import { useQuery } from \"react-query\"\r\nimport { User } from \"../types/User\"\r\nimport { useHttp } from \"./http\"\r\n\r\nexport const useUsers = (param?: Partial<User>) => {\r\n    const client = useHttp()\r\n\r\n\r\n    return useQuery<User[]>([\"users\", param], () =>\r\n    client(\"users\", { data: param })\r\n  )\r\n}","import Select from 'antd/lib/select'\r\nimport React from 'react'\r\nimport { Raw } from '../types'\r\n\r\ntype SelectProps = React.ComponentProps<typeof Select> \r\n\r\ninterface IdSelectProps extends Omit<SelectProps, 'value' | 'onChange' | 'options'>{\r\n  value?: Raw | null | undefined,\r\n  onChange?: (value?: number) => void,\r\n  defaultOptionName?: string,\r\n  options?: { name: string, id: number }[]\r\n} \r\n\r\n/**\r\n * value 可以传入多种类型的值\r\n * onChaneg 只会回调 number | undefined 类型\r\n * 当 isNaN(Number(value)) 为 true 的时候，代表选择默认类型\r\n * 当选择默认类型的时候，onChange 会回调 undefined\r\n */\r\n\r\nexport const IdSelect = (props: IdSelectProps) => {\r\n  const { value, onChange, defaultOptionName, options, ...restProps } = props\r\n  return <Select \r\n    value={options?.length ? toNumber(value) : 0} \r\n    onChange={value => onChange?.(toNumber(value) || undefined)}\r\n    {...restProps}\r\n  >\r\n    {\r\n      defaultOptionName ? <Select.Option value={0}>{defaultOptionName}</Select.Option> : null\r\n    }\r\n    {\r\n      options?.map(option => <Select.Option key={option.id} value={option.id}>{option.name}</Select.Option>)\r\n    }\r\n  </Select>\r\n}\r\n\r\nconst toNumber = (value: unknown) => isNaN(Number(value)) ? 0 : Number(value)\r\n","import React from \"react\";\r\nimport { useUsers } from \"../utils/user\";\r\nimport { IdSelect } from \"./id-select\";\r\n\r\nexport const UserSelect = (props: React.ComponentProps<typeof IdSelect>) => {\r\n  const { data: users } = useUsers();\r\n  return <IdSelect options={users || []} {...props} />;\r\n};","import { Form, Input } from \"antd\";\r\nimport { UserSelect } from \"../../components/user-select\";\r\nimport { Project } from \"../../types/Project\";\r\nimport { User } from \"../../types/User\";\r\n\r\ninterface SearchPanelProps {\r\n  users: User[],\r\n  param: Partial<Pick<Project, 'name' | 'personId'>>\r\n  setParam: (param: SearchPanelProps['param']) => void;\r\n}\r\n\r\nexport const SearchPanel = ({ param, setParam, users }: SearchPanelProps) => {\r\n\r\n  return (\r\n    <Form style={{ marginBottom: '2rem' }} layout={\"inline\"}>\r\n      <Form.Item>\r\n        <Input\r\n          placeholder={'项目名'}\r\n          type=\"text\"\r\n          value={param.name}\r\n          onChange={evt => setParam({\r\n            ...param,\r\n            name: evt.target.value\r\n          })} />\r\n      </Form.Item>\r\n      <Form.Item>\r\n        <UserSelect\r\n          defaultOptionName={'负责人'}\r\n          value={param.personId}\r\n          onChange={(value) => setParam({\r\n            ...param,\r\n            personId: value\r\n          })} />\r\n\r\n      </Form.Item>\r\n\r\n    </Form>\r\n  )\r\n}\r\n// setParam(Object.assign({}, param, {name: evt.target.value}))","import Rate from 'antd/lib/rate'\r\nimport React from 'react'\r\n\r\ninterface PinProps extends React.ComponentProps<typeof Rate> {\r\n  checked: boolean,\r\n  onCheckedChange?: (checked: boolean) => void\r\n}\r\n\r\nexport const Pin = ({ checked, onCheckedChange, ...restProps }: PinProps) => {\r\n  return <Rate\r\n    count={1}\r\n    value={checked ? 1 : 0}\r\n    onChange={num => onCheckedChange?.(!!num)}\r\n    {...restProps}\r\n  />\r\n}","/**\r\n * 在本地对排序进行乐观更新\r\n * @param fromId 要排序的项目的id\r\n * @param type 'before' | 'after'\r\n * @param referenceId 参照id\r\n * @param list 要排序的列表, 比如tasks, kanbans\r\n */\r\n export const reorder = ({\r\n  fromId,\r\n  type,\r\n  referenceId,\r\n  list,\r\n}: {\r\n  list: { id: number }[]\r\n  fromId: number\r\n  type: \"after\" | \"before\"\r\n  referenceId: number\r\n}) => {\r\n  const copiedList = [...list]\r\n  // 找到fromId对应项目的下标\r\n  const movingItemIndex = copiedList.findIndex((item) => item.id === fromId)\r\n  if (!referenceId) {\r\n    return insertAfter([...copiedList], movingItemIndex, copiedList.length - 1)\r\n  }\r\n  const targetIndex = copiedList.findIndex((item) => item.id === referenceId)\r\n  const insert = type === \"after\" ? insertAfter : insertBefore\r\n  return insert([...copiedList], movingItemIndex, targetIndex)\r\n};\r\n\r\n/**\r\n * 在list中，把from放在to的前边\r\n * @param list\r\n * @param from\r\n * @param to\r\n */\r\nconst insertBefore = (list: unknown[], from: number, to: number) => {\r\n  const toItem = list[to]\r\n  const removedItem = list.splice(from, 1)[0]\r\n  const toIndex = list.indexOf(toItem)\r\n  list.splice(toIndex, 0, removedItem)\r\n  return list\r\n};\r\n\r\n/**\r\n * 在list中，把from放在to的后面\r\n * @param list\r\n * @param from\r\n * @param to\r\n */\r\nconst insertAfter = (list: unknown[], from: number, to: number) => {\r\n  const toItem = list[to]\r\n  const removedItem = list.splice(from, 1)[0]\r\n  const toIndex = list.indexOf(toItem)\r\n  list.splice(toIndex + 1, 0, removedItem)\r\n  return list\r\n}","import { QueryKey, useQueryClient } from \"react-query\"\r\nimport { Task } from \"../types/task\";\r\nimport { reorder } from \"./reorder\";\r\n\r\nexport const useConfig = (\r\n  queryKey: QueryKey,\r\n  callback: (target: any, old?: any[]) => any[]\r\n) => {\r\n  const queryClient = useQueryClient();\r\n  return {\r\n    onSuccess: () => queryClient.invalidateQueries(queryKey),\r\n    async onMutate(target: any) {\r\n      const previousItems = queryClient.getQueryData(queryKey)\r\n      queryClient.setQueryData(queryKey, (old?: any[]) => {\r\n        return callback(target, old)\r\n      })\r\n      return { previousItems }\r\n    },\r\n    onError(error: any, newItem: any, context: any) {\r\n      queryClient.setQueryData(queryKey, context.previousItems)\r\n    },\r\n  }\r\n}\r\n\r\nexport const useDeleteConfig = (queryKey: QueryKey) =>\r\n  useConfig(\r\n    queryKey,\r\n    (target, old) => old?.filter((item) => item.id !== target.id) || []\r\n  )\r\nexport const useEditConfig = (queryKey: QueryKey) =>\r\n  useConfig(\r\n    queryKey,\r\n    (target, old) =>\r\n      old?.map((item) =>\r\n        item.id === target.id ? { ...item, ...target } : item\r\n      ) || []\r\n  )\r\nexport const useAddConfig = (queryKey: QueryKey) =>\r\n  useConfig(queryKey, (target, old) => (old ? [...old, target] : []))\r\n\r\nexport const useReorderKanbanConfig = (queryKey: QueryKey) =>\r\n  useConfig(queryKey, (target, old) => reorder({ list: old, ...target }))\r\n\r\nexport const useReorderTaskConfig = (queryKey: QueryKey) =>\r\n  useConfig(queryKey, (target, old) => {\r\n    const orderedList = reorder({ list: old, ...target }) as Task[]\r\n    return orderedList.map((item) =>\r\n      item.id === target.fromId\r\n        ? { ...item, kanbanId: target.toKanbanId }\r\n        : item\r\n    )\r\n  })\r\n","import { Project } from \"../types/Project\";\r\nimport { cleanObject } from \".\";\r\nimport { useHttp } from \"./http\";\r\nimport {  QueryKey, useMutation, useQuery } from 'react-query';\r\nimport { useAddConfig, useDeleteConfig, useEditConfig } from './use-optimistic-options';\r\n\r\nexport const useProjects = (param?: Partial<Project>) => {\r\n  const client = useHttp();\r\n\r\n  return useQuery<Project[]>([\"projects\", cleanObject(param)], () =>\r\n    client(\"projects\", { data: param })\r\n  )\r\n}\r\n\r\nexport const useEditProject = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n  return useMutation(\r\n    (params: Partial<Project>) =>\r\n      client(`projects/${params.id}`, {\r\n        method: \"PATCH\",\r\n        data: params,\r\n      }),\r\n    useEditConfig(queryKey)\r\n  )\r\n}\r\n\r\nexport const useAddProject = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n\r\n  return useMutation(\r\n    (params: Partial<Project>) =>\r\n      client(`projects`, {\r\n        data: params,\r\n        method: \"POST\",\r\n      }),\r\n    useAddConfig(queryKey)\r\n  )\r\n}\r\n\r\nexport const useDeleteProject = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n\r\n  return useMutation(\r\n    ({ id }: { id: number }) =>\r\n      client(`projects/${id}`, {\r\n        method: \"DELETE\",\r\n      }),\r\n    useDeleteConfig(queryKey)\r\n  )\r\n}\r\n\r\nexport const useProject = (id?: number) => {\r\n  const client = useHttp();\r\n  return useQuery<Project>(\r\n    [\"project\", { id }],\r\n    () => client(`projects/${id}`),\r\n    {\r\n      enabled: Boolean(id),\r\n    }\r\n  )\r\n}\r\n\r\n\r\n\r\n","/**\r\n * 返回页面 url 中，指定键的参数值\r\n */\r\n\r\nimport { useMemo, useState } from 'react';\r\nimport { URLSearchParamsInit, useSearchParams } from 'react-router-dom';\r\nimport { cleanObject, subset } from '.';\r\n\r\nexport const useUrlQueryParam = <K extends string>(keys: K[]) => {\r\n  const [searchParams] = useSearchParams()\r\n  const setSearchParams = useSetUrlSearchParam()\r\n  const [stateKeys] = useState(keys)\r\n  return [\r\n    useMemo(\r\n      () =>\r\n        subset(Object.fromEntries(searchParams), stateKeys) as {\r\n          [key in K]: string;\r\n        },\r\n      [searchParams, stateKeys]\r\n    ),\r\n    (params: Partial<{ [key in K]: unknown }>) => {\r\n      return setSearchParams(params);\r\n      \r\n    },\r\n  ] as const;\r\n}\r\n\r\nexport const useSetUrlSearchParam = () => {\r\n  const [searchParams, setSearchParam] = useSearchParams()\r\n  return (params: { [key in string]: unknown }) => {\r\n    const o = cleanObject({\r\n      ...Object.fromEntries(searchParams),\r\n      ...params\r\n    }) as URLSearchParamsInit\r\n    return setSearchParam(o)\r\n  }\r\n}\r\n","import { useMemo } from \"react\"\r\nimport { useProject } from \"../../utils/project\"\r\nimport { useSetUrlSearchParam, useUrlQueryParam } from \"../../utils/url\"\r\n\r\n// 项目列表搜索的参数\r\nexport const useProjectsSearchParams = () => {\r\n  const [param, setParam] = useUrlQueryParam([\"name\", \"personId\"]);\r\n  return [\r\n    useMemo(\r\n      () => ({ ...param, personId: Number(param.personId) || undefined }),\r\n      [param]\r\n    ),\r\n    setParam,\r\n  ] as const\r\n}\r\n\r\nexport const useProjectsQueryKey = () => {\r\n  const [params] = useProjectsSearchParams()\r\n  return [\"projects\", params]\r\n}\r\n\r\nexport const useProjectModal = () => {\r\n  const [{ projectCreate }, setProjectCreate] = useUrlQueryParam([\r\n    'projectCreate'\r\n  ])\r\n\r\n  const [{ editingProjectId }, setEditingProjectId] = useUrlQueryParam([\r\n    'editingProjectId'\r\n  ])\r\n\r\n  const setUrlParams = useSetUrlSearchParam()\r\n\r\n  const { data: editingProject, isLoading } = useProject(Number(editingProjectId))\r\n\r\n  const open = () => setProjectCreate({ projectCreate: true })\r\n  const close = () => setUrlParams({\r\n    projectCreate: '',\r\n    editingProjectId: ''\r\n  })\r\n  const startEdit = (id: number) => setEditingProjectId({ editingProjectId: id })\r\n\r\n  return {\r\n    projectModalOpen: projectCreate === 'true' || Boolean(editingProjectId),\r\n    open,\r\n    close,\r\n    startEdit,\r\n    editingProject,\r\n    isLoading\r\n  }\r\n}","import { Dropdown, Menu, Modal, Table, TableProps } from \"antd\";\r\nimport dayjs from \"dayjs\";\r\nimport { User } from \"../../types/User\";\r\nimport { Link } from 'react-router-dom';\r\nimport { Pin } from '../../components/pin';\r\nimport {  useDeleteProject, useEditProject } from \"../../utils/project\";\r\nimport { ButtonNoPadding } from \"../../components/lib\";\r\n// import { useDispatch } from \"react-redux\";\r\nimport { useProjectModal, useProjectsQueryKey } from \"./util\";\r\nimport { Project } from \"../../types/Project\";\r\ninterface ListProps extends TableProps<Project> {\r\n  users: User[];\r\n  refresh?: () => void\r\n}\r\n\r\n// type PropsType = Omit<ListProps, 'users'>\r\n\r\nexport const List = ({ users, ...props }: ListProps) => {\r\n  // const dispatch = useDispatch()\r\n  const { mutate } = useEditProject(useProjectsQueryKey())\r\n  const pinProject = (id: number) => (pin: boolean) => mutate({ id, pin })\r\n\r\n  return (\r\n    <Table\r\n      rowKey={'id'}\r\n      pagination={false}\r\n      columns={[\r\n        {\r\n          title: <Pin checked={true} disabled={true} />,\r\n          render(value, project) {\r\n            return <Pin \r\n                      checked={project.pin} \r\n                      onCheckedChange={pinProject(project.id)} \r\n                    />\r\n          }\r\n        },\r\n        {\r\n          title: \"名称\",\r\n          sorter: (a, b) => a.name.localeCompare(b.name),\r\n          render(value, project) {\r\n            return <Link to={String(project.id)}>{project.name}</Link>;\r\n          },\r\n        },\r\n        {\r\n          title: '部门',\r\n          dataIndex: 'organization',\r\n        },\r\n        {\r\n          title: '负责人',\r\n          render(value, project) {\r\n            return <span>\r\n              {users.find(user => user.id === project.personId)?.name || '未知'}\r\n            </span>\r\n          }\r\n        },\r\n        {\r\n          title: '创建时间',\r\n          render(value, project) {\r\n            return <span>\r\n              {project.created ? dayjs(project.created).format('YYYY-MM-DD') : '无'}\r\n            </span>\r\n          }\r\n        }, \r\n        {\r\n          render(value, project) {\r\n            return (\r\n              <More project={project} />\r\n            )\r\n          }\r\n        }\r\n      ]}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport const More = ({ project }: { project: Project }) => {\r\n  const { startEdit } = useProjectModal()\r\n  const editProject = (id: number) => () => startEdit(id)\r\n  const { mutate: deleteProject } = useDeleteProject(useProjectsQueryKey())\r\n  const confirmDeleteProject = (id: number) => {\r\n    Modal.confirm({\r\n      title: '确定删除这个项目吗?',\r\n      content: '点击确定删除',\r\n      okText: '确定',\r\n      cancelText: '取消',\r\n      onOk() {\r\n        deleteProject({id})\r\n      }\r\n    })\r\n  }\r\n  return (\r\n    <Dropdown\r\n      overlay={\r\n        <Menu>\r\n          <Menu.Item \r\n            onClick={editProject(project.id)} \r\n            key={'edit'}\r\n          >\r\n            编辑\r\n          </Menu.Item>\r\n          <Menu.Item \r\n            onClick={() => confirmDeleteProject(project.id)} \r\n            key={'edit'}\r\n          >\r\n            删除\r\n          </Menu.Item>\r\n        </Menu>\r\n      }\r\n    >\r\n      <ButtonNoPadding type={'link'}>...</ButtonNoPadding>\r\n    </Dropdown>\r\n  )\r\n}","import React from \"react\";\r\nimport { ProfilerOnRenderCallback, ProfilerProps } from \"react\";\r\n\r\ntype Props = { metadata?: any; phases?: (\"mount\" | \"update\")[] } & Omit<\r\n  ProfilerProps,\r\n  \"onRender\"\r\n>;\r\n\r\nlet queue: unknown[] = [];\r\n\r\nconst sendProfileQueue = () => {\r\n  if (!queue.length) {\r\n    return;\r\n  }\r\n  const queueToSend = [...queue];\r\n  queue = [];\r\n  console.log(queueToSend);\r\n};\r\n\r\nsetInterval(sendProfileQueue, 5000);\r\n\r\nexport const Profiler = ({ metadata, phases, ...props }: Props) => {\r\n  const reportProfile: ProfilerOnRenderCallback = (\r\n    id,\r\n    phase,\r\n    actualDuration,\r\n    baseDuration,\r\n    startTime,\r\n    commitTime,\r\n    interactions\r\n  ) => {\r\n    if (!phases || phases.includes(phase)) {\r\n      queue.push({\r\n        id,\r\n        phase,\r\n        actualDuration,\r\n        baseDuration,\r\n        startTime,\r\n        commitTime,\r\n        interactions,\r\n        metadata,\r\n      });\r\n    }\r\n  };\r\n\r\n  return <React.Profiler onRender={reportProfile} {...props} />;\r\n};","import { SearchPanel } from \"./search-panel\";\r\nimport { List } from \"./list\";\r\nimport { useDebounce, useDocumentTitle } from \"../../utils\";\r\nimport { useProjects } from \"../../utils/project\";\r\nimport { useUsers } from \"../../utils/user\";\r\nimport { useProjectModal, useProjectsSearchParams } from \"./util\";\r\n// import { projectListActions } from \"./project-list.slice\";\r\nimport { ButtonNoPadding, ErrorBox, Row, ScreenContainer } from \"../../components/lib\";\r\nimport { Profiler } from \"../../components/profiler\";\r\n\r\nexport const ProjectListScreen = () => {\r\n  useDocumentTitle('项目列表', false)\r\n  \r\n  const {open} = useProjectModal()\r\n\r\n  const [param, setParam] = useProjectsSearchParams()\r\n  const { isLoading, error, data: list } = useProjects(useDebounce(param, 200))\r\n  const { data: users } = useUsers()\r\n\r\n   // 改用context,不用 redux\r\n  // const dispatch = useDispatch()\r\n\r\n  return (\r\n    <Profiler id={\"项目列表\"}>\r\n      <ScreenContainer>\r\n      <Row marginBottom={2} between={true}>\r\n        <h1>项目列表</h1>\r\n        <ButtonNoPadding onClick={open} type={'link'}\r\n          // onClick={() => dispatch(projectListActions.openProjectModal())}\r\n        >\r\n          创建项目\r\n        </ButtonNoPadding>\r\n      </Row>\r\n      <SearchPanel users={users || []} param={param} setParam={setParam} />\r\n      <ErrorBox error={error} />\r\n      <List \r\n        loading={isLoading} \r\n        dataSource={list || []} \r\n        users={users || []} \r\n      />\r\n      </ScreenContainer>\r\n    </Profiler>\r\n  )\r\n}\r\n\r\nProjectListScreen.whyDidYouRender = false\r\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"linearGradient\", {\n  x1: \"97.6553341%\",\n  y1: \"35.6591143%\",\n  x2: \"37.202032%\",\n  y2: \"75.4891864%\",\n  id: \"uid392-1\"\n}, /*#__PURE__*/React.createElement(\"stop\", {\n  stopColor: \"#0052CC\",\n  offset: \"7%\"\n}), /*#__PURE__*/React.createElement(\"stop\", {\n  stopColor: \"#2684FF\",\n  offset: \"100%\"\n})), /*#__PURE__*/React.createElement(\"linearGradient\", {\n  x1: \"8.43371138%\",\n  y1: \"60.1495759%\",\n  x2: \"64.1161517%\",\n  y2: \"23.5790285%\",\n  id: \"uid392-2\"\n}, /*#__PURE__*/React.createElement(\"stop\", {\n  stopColor: \"#0052CC\",\n  offset: \"0%\"\n}), /*#__PURE__*/React.createElement(\"stop\", {\n  stopColor: \"#2684FF\",\n  offset: \"100%\"\n})));\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"g\", {\n  stroke: \"none\",\n  strokeWidth: 1,\n  fillRule: \"nonzero\"\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M11.3881081,27.9242105 C12.4881804,26.8071817 13.1062496,25.2917664 13.1062496,23.7115789 C13.1062496,22.1313915 12.4881804,20.6159762 11.3881081,19.4989474 L11.3881081,19.4989474 L3.74837838,11.7621053 L0.273513514,15.2926316 C-0.0900771727,15.6625064 -0.0900771727,16.2617042 0.273513514,16.6315789 L11.3881081,27.9242105 L11.3881081,27.9242105 Z\",\n  fill: \"currentColor\",\n  fillRule: \"nonzero\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M22.5027027,15.2926316 L11.3881081,4 L11.3881081,4 L11.3539189,4.03473684 L11.3539189,4.03473684 C9.08852466,6.36456187 9.09963243,10.1156459 11.3787838,12.4315789 L19.0247297,20.1652632 L22.5027027,16.6315789 C22.8662934,16.2617042 22.8662934,15.6625064 22.5027027,15.2926316 Z\",\n  fill: \"currentColor\",\n  fillRule: \"nonzero\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M11.3881081,12.4252632 C9.10895676,10.1093301 9.09784899,6.35824608 11.3632432,4.02842105 L3.43445946,12.0810526 L7.58067568,16.2936842 L11.3881081,12.4252632 Z\",\n  fill: \"url(#uid392-1)\",\n  fillRule: \"nonzero\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M15.1893243,15.6368421 L11.3881081,19.4989474 C12.4881804,20.6159762 13.1062496,22.1313915 13.1062496,23.7115789 C13.1062496,25.2917664 12.4881804,26.8071817 11.3881081,27.9242105 L19.3355405,19.8494737 L15.1893243,15.6368421 Z\",\n  fill: \"url(#uid392-2)\",\n  fillRule: \"nonzero\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M36.07,18.956 C36.07,20.646 35.394,21.842 33.418,21.842 C32.56,21.842 31.702,21.686 31,21.4 L31,23.662 C31.65,23.896 32.586,24.104 33.808,24.104 C37.032,24.104 38.41,21.946 38.41,18.8 L38.41,6.918 L36.07,6.918 L36.07,18.956 Z M41.894,7.568 C41.894,8.556 42.544,9.128 43.454,9.128 C44.364,9.128 45.014,8.556 45.014,7.568 C45.014,6.58 44.364,6.008 43.454,6.008 C42.544,6.008 41.894,6.58 41.894,7.568 Z M42.31,24 L44.546,24 L44.546,11 L42.31,11 L42.31,24 Z M47.926,24 L50.11,24 L50.11,16.33 C50.11,13.574 51.852,12.716 54.712,13.002 L54.712,10.818 C52.164,10.662 50.864,11.754 50.11,13.288 L50.11,11 L47.926,11 L47.926,24 Z M65.45,24 L65.45,21.66 C64.618,23.376 63.058,24.26 61.056,24.26 C57.598,24.26 55.856,21.322 55.856,17.5 C55.856,13.834 57.676,10.74 61.316,10.74 C63.214,10.74 64.67,11.598 65.45,13.288 L65.45,11 L67.686,11 L67.686,24 L65.45,24 Z M58.092,17.5 C58.092,20.62 59.34,22.18 61.654,22.18 C63.656,22.18 65.45,20.906 65.45,18.02 L65.45,16.98 C65.45,14.094 63.812,12.82 61.914,12.82 C59.392,12.82 58.092,14.484 58.092,17.5 Z M86.926,19.294 C86.926,16.226 84.898,15.056 81.284,14.146 C78.268,13.392 77.176,12.69 77.176,11.286 C77.176,9.726 78.502,8.946 80.738,8.946 C82.506,8.946 84.352,9.258 86.068,10.246 L86.068,7.906 C84.898,7.256 83.312,6.658 80.842,6.658 C76.864,6.658 74.836,8.634 74.836,11.286 C74.836,14.094 76.552,15.42 80.4,16.356 C83.65,17.136 84.586,17.942 84.586,19.45 C84.586,20.958 83.624,21.972 81.05,21.972 C78.788,21.972 76.344,21.374 74.758,20.542 L74.758,22.934 C76.084,23.61 77.618,24.26 80.92,24.26 C85.158,24.26 86.926,22.258 86.926,19.294 Z M95.09,24.26 C91.19,24.26 88.902,21.374 88.902,17.474 C88.902,13.574 91.19,10.74 95.09,10.74 C98.964,10.74 101.226,13.574 101.226,17.474 C101.226,21.374 98.964,24.26 95.09,24.26 Z M95.09,12.82 C92.308,12.82 91.086,15.004 91.086,17.474 C91.086,19.944 92.308,22.18 95.09,22.18 C97.846,22.18 99.042,19.944 99.042,17.474 C99.042,15.004 97.846,12.82 95.09,12.82 Z M106.92,9.622 C106.92,8.452 107.596,7.646 108.974,7.646 C109.494,7.646 109.988,7.698 110.378,7.776 L110.378,5.722 C109.988,5.618 109.546,5.514 108.87,5.514 C106.088,5.514 104.736,7.152 104.736,9.57 L104.736,11 L102.63,11 L102.63,13.08 L104.736,13.08 L104.736,24 L106.92,24 L106.92,13.08 L110.274,13.08 L110.274,11 L106.92,11 L106.92,9.622 Z M115.786,19.892 L115.786,13.08 L119.244,13.08 L119.244,11 L115.786,11 L115.786,8.244 L113.602,8.244 L113.602,11 L111.496,11 L111.496,13.08 L113.602,13.08 L113.602,19.944 C113.602,22.362 114.954,24 117.736,24 C118.412,24 118.854,23.896 119.244,23.792 L119.244,21.634 C118.854,21.712 118.36,21.816 117.84,21.816 C116.462,21.816 115.786,21.036 115.786,19.892 Z M125.432,24 L128.292,24 L130.528,17.708 L131.724,13.704 L132.92,17.708 L135.156,24 L138.016,24 L142.8,11 L140.33,11 L136.586,22.024 L132.79,11 L130.658,11 L126.862,22.024 L123.118,11 L120.648,11 L125.432,24 Z M153.538,24 L153.538,21.66 C152.706,23.376 151.146,24.26 149.144,24.26 C145.686,24.26 143.944,21.322 143.944,17.5 C143.944,13.834 145.764,10.74 149.404,10.74 C151.302,10.74 152.758,11.598 153.538,13.288 L153.538,11 L155.774,11 L155.774,24 L153.538,24 Z M146.18,17.5 C146.18,20.62 147.428,22.18 149.742,22.18 C151.744,22.18 153.538,20.906 153.538,18.02 L153.538,16.98 C153.538,14.094 151.9,12.82 150.002,12.82 C147.48,12.82 146.18,14.484 146.18,17.5 Z M159.154,24 L161.338,24 L161.338,16.33 C161.338,13.574 163.08,12.716 165.94,13.002 L165.94,10.818 C163.392,10.662 162.092,11.754 161.338,13.288 L161.338,11 L159.154,11 L159.154,24 Z M178.108,23.48 C177.042,24.052 175.404,24.26 174.078,24.26 C169.216,24.26 167.084,21.452 167.084,17.474 C167.084,13.548 169.268,10.74 173.22,10.74 C177.224,10.74 178.836,13.522 178.836,17.474 L178.836,18.488 L169.346,18.488 C169.658,20.698 171.088,22.128 174.156,22.128 C175.664,22.128 176.938,21.842 178.108,21.426 L178.108,23.48 Z M173.116,12.768 C170.75,12.768 169.554,14.302 169.32,16.564 L176.574,16.564 C176.444,14.146 175.352,12.768 173.116,12.768 Z\",\n  fill: \"inherit\",\n  fillRule: \"evenodd\"\n}));\n\nfunction SvgSoftwareLogo(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    viewBox: \"0 0 179 32\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    focusable: \"false\",\n    \"aria-hidden\": \"true\",\n    className: \"css-sq9aeg-Logo\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _ref2, _ref3);\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgSoftwareLogo);\nexport default __webpack_public_path__ + \"static/media/software-logo.ec204298.svg\";\nexport { ForwardRef as ReactComponent };","import { QueryKey, useMutation, useQuery } from \"react-query\";\r\nimport { Epic } from \"../types/epic\";\r\nimport { useHttp } from \"./http\";\r\nimport { useAddConfig, useDeleteConfig } from \"./use-optimistic-options\";\r\n\r\n\r\nexport const useEpics = (param?: Partial<Epic>) => {\r\n  const client = useHttp();\r\n\r\n  return useQuery<Epic[]>([\"epics\", param], () =>\r\n    client(\"epics\", { data: param })\r\n  );\r\n};\r\n\r\nexport const useAddEpic = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n\r\n  return useMutation(\r\n    (params: Partial<Epic>) =>\r\n      client(`epics`, {\r\n        data: params,\r\n        method: \"POST\",\r\n      }),\r\n    useAddConfig(queryKey)\r\n  );\r\n};\r\n\r\nexport const useDeleteEpic = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n\r\n  return useMutation(\r\n    ({ id }: { id: number }) =>\r\n      client(`epics/${id}`, {\r\n        method: \"DELETE\",\r\n      }),\r\n    useDeleteConfig(queryKey)\r\n  );\r\n};","import { useHttp } from \"./http\"\r\nimport { QueryKey, useMutation, useQuery } from \"react-query\"\r\nimport { Task } from \"../types/task\"\r\nimport { useAddConfig, useDeleteConfig, useEditConfig, useReorderTaskConfig } from \"./use-optimistic-options\"\r\nimport { Project } from \"../types/Project\"\r\nimport { SortProps } from \"./kanban\"\r\n\r\nexport const useTasks = (param?: Partial<Task>) => {\r\n  const client = useHttp()\r\n\r\n  return useQuery<Task[]>([\"tasks\", param], () =>\r\n    client(\"tasks\", { data: param })\r\n  )\r\n}\r\n\r\n\r\nexport const useTask = (id?: number) => {\r\n  const client = useHttp()\r\n  return useQuery<Project>([\"task\", { id }], () => client(`tasks/${id}`), {\r\n    enabled: Boolean(id),\r\n  })\r\n}\r\n\r\nexport const useAddTask = (queryKey: QueryKey) => {\r\n  const client = useHttp()\r\n\r\n  return useMutation(\r\n    (params: Partial<Task>) =>\r\n      client(`tasks`, {\r\n        data: params,\r\n        method: \"POST\",\r\n      }),\r\n    useAddConfig(queryKey)\r\n  )\r\n}\r\n\r\n\r\n\r\nexport const useEditTask = (queryKey: QueryKey) => {\r\n  const client = useHttp()\r\n  return useMutation(\r\n    (params: Partial<Task>) =>\r\n      client(`tasks/${params.id}`, {\r\n        method: \"PATCH\",\r\n        data: params,\r\n      }),\r\n    useEditConfig(queryKey)\r\n  )\r\n}\r\n\r\nexport const useDeleteTask = (queryKey: QueryKey) => {\r\n  const client = useHttp()\r\n\r\n  return useMutation(\r\n    ({ id }: { id: number }) =>\r\n      client(`tasks/${id}`, {\r\n        method: \"DELETE\",\r\n      }),\r\n    useDeleteConfig(queryKey)\r\n  )\r\n}\r\n\r\nexport const useReorderTask = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n  return useMutation((params: SortProps) => {\r\n    return client(\"tasks/reorder\", {\r\n      data: params,\r\n      method: \"POST\",\r\n    });\r\n  }, useReorderTaskConfig(queryKey))\r\n}","import { useCallback, useMemo } from \"react\"\r\nimport { useLocation } from \"react-router\"\r\nimport { useDebounce } from \"../../utils\"\r\nimport { useProject } from \"../../utils/project\"\r\nimport { useTask } from \"../../utils/task\"\r\nimport { useUrlQueryParam } from \"../../utils/url\"\r\n\r\nexport const useProjectIdInUrl = () => {\r\n  const { pathname } = useLocation();\r\n  const id = pathname.match(/projects\\/(\\d+)/)?.[1];\r\n  return Number(id);\r\n}\r\n\r\nexport const useProjectInUrl = () => useProject(useProjectIdInUrl())\r\n\r\nexport const useKanbanSearchParams = () => ({ projectId: useProjectIdInUrl() })\r\n\r\nexport const useKanbansQueryKey = () => ['kanbans', useKanbanSearchParams()]\r\n\r\nexport const useTasksSearchParams = () => {\r\n  const [param] = useUrlQueryParam([\r\n    \"name\",\r\n    \"typeId\",\r\n    \"processorId\",\r\n    \"tagId\",\r\n  ])\r\n  const projectId = useProjectIdInUrl()\r\n  const debouncedName = useDebounce(param.name, 200)\r\n  return useMemo(\r\n    () => ({\r\n      projectId,\r\n      typeId: Number(param.typeId) || undefined,\r\n      processorId: Number(param.processorId) || undefined,\r\n      tagId: Number(param.tagId) || undefined,\r\n      name: debouncedName,\r\n    }),\r\n    [projectId, param, debouncedName]\r\n  )\r\n}\r\n\r\nexport const useTasksQueryKey = () => [\"tasks\", useTasksSearchParams()]\r\n\r\nexport const useTasksModal = () => {\r\n  const [{ editingTaskId }, setEditingTaskId] = useUrlQueryParam([\r\n    \"editingTaskId\",\r\n  ])\r\n  const { data: editingTask, isLoading } = useTask(Number(editingTaskId))\r\n  const startEdit = useCallback(\r\n    (id: number) => {\r\n      setEditingTaskId({ editingTaskId: id })\r\n    },\r\n    [setEditingTaskId]\r\n  );\r\n  const close = useCallback(() => {\r\n    setEditingTaskId({ editingTaskId: \"\" })\r\n  }, [setEditingTaskId])\r\n  return {\r\n    editingTaskId,\r\n    editingTask,\r\n    startEdit,\r\n    close,\r\n    isLoading,\r\n  }\r\n}\r\n","import { useProjectIdInUrl } from \"../kanban/util\"\r\n\r\nexport const useEpicSearchParams = () => ({ projectId: useProjectIdInUrl() })\r\n\r\nexport const useEpicsQueryKey = () => [\"epics\", useEpicSearchParams()]","import styled from \"@emotion/styled\";\r\nimport { Button, Drawer, DrawerProps, Form, Input, Spin } from \"antd\";\r\nimport { useEffect } from \"react\";\r\nimport { ErrorBox } from \"../../components/lib\";\r\nimport { useAddEpic } from \"../../utils/epic\";\r\nimport { useProjectIdInUrl } from \"../kanban/util\";\r\nimport { useEpicsQueryKey } from \"./util\";\r\n\r\nexport const CreateEpic = (\r\n  props: Pick<DrawerProps, \"visible\"> & { onClose: () => void }\r\n) => {\r\n  const { mutate: addEpic, isLoading, error } = useAddEpic(useEpicsQueryKey())\r\n  const [form] = Form.useForm()\r\n  const projectId = useProjectIdInUrl()\r\n\r\n  const onFinish = async (values: any) => {\r\n    await addEpic({ ...values, projectId })\r\n    props.onClose()\r\n  };\r\n\r\n  useEffect(() => {\r\n    form.resetFields()\r\n  }, [form, props.visible])\r\n\r\n  return (\r\n    <Drawer\r\n      visible={props.visible}\r\n      onClose={props.onClose}\r\n      forceRender={true}\r\n      destroyOnClose={true}\r\n      width={\"100%\"}\r\n    >\r\n      <Container>\r\n        {isLoading ? (\r\n          <Spin size={\"large\"} />\r\n        ) : (\r\n          <>\r\n            <h1>创建任务组</h1>\r\n            <ErrorBox error={error} />\r\n            <Form\r\n              form={form}\r\n              layout={\"vertical\"}\r\n              style={{ width: \"40rem\" }}\r\n              onFinish={onFinish}\r\n            >\r\n              <Form.Item\r\n                label={\"名称\"}\r\n                name={\"name\"}\r\n                rules={[{ required: true, message: \"请输入任务组名\" }]}\r\n              >\r\n                <Input placeholder={\"请输入任务组名称\"} />\r\n              </Form.Item>\r\n\r\n              <Form.Item style={{ textAlign: \"right\" }}>\r\n                <Button\r\n                  loading={isLoading}\r\n                  type={\"primary\"}\r\n                  htmlType={\"submit\"}\r\n                >\r\n                  提交\r\n                </Button>\r\n              </Form.Item>\r\n            </Form>\r\n          </>\r\n        )}\r\n      </Container>\r\n    </Drawer>\r\n  );\r\n};\r\n\r\nconst Container = styled.div`\r\n  height: 80vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n`;\r\n\r\n","import { Button, List, Modal } from 'antd';\r\nimport dayjs from 'dayjs';\r\nimport React, { useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { Row, ScreenContainer } from '../../components/lib';\r\nimport { Epic } from '../../types/epic';\r\nimport { useDeleteEpic, useEpics } from '../../utils/epic';\r\nimport { useTasks } from '../../utils/task';\r\nimport { useProjectInUrl } from '../kanban/util';\r\nimport { CreateEpic } from './create-epic';\r\nimport { useEpicSearchParams, useEpicsQueryKey } from './util';\r\n\r\nexport const EpicScreen = () => {\r\n    const { data: currentProject } = useProjectInUrl();\r\n    const { data: epics } = useEpics(useEpicSearchParams());\r\n    const { data: tasks } = useTasks({ projectId: currentProject?.id });\r\n    const { mutate: deleteEpic } = useDeleteEpic(useEpicsQueryKey());\r\n    const [epicCreateOpen, setEpicCreateOpen] = useState(false);\r\n  \r\n    const confirmDeleteEpic = (epic: Epic) => {\r\n      Modal.confirm({\r\n        title: `确定删除项目组：${epic.name}`,\r\n        content: \"点击确定删除\",\r\n        okText: \"确定\",\r\n        onOk() {\r\n          deleteEpic({ id: epic.id })\r\n        },\r\n      })\r\n    }\r\n  \r\n    return (\r\n      <ScreenContainer>\r\n        <Row between={true}>\r\n          <h1>{currentProject?.name}任务组</h1>\r\n          <Button onClick={() => setEpicCreateOpen(true)} type={\"link\"}>\r\n            创建任务组\r\n          </Button>\r\n        </Row>\r\n        <List\r\n          style={{ overflow: \"scroll\" }}\r\n          dataSource={epics}\r\n          itemLayout={\"vertical\"}\r\n          renderItem={(epic) => (\r\n            <List.Item>\r\n              <List.Item.Meta\r\n                title={\r\n                  <Row between={true}>\r\n                    <span>{epic.name}</span>\r\n                    <Button onClick={() => confirmDeleteEpic(epic)} type={\"link\"}>\r\n                      删除\r\n                    </Button>\r\n                  </Row>\r\n                }\r\n                description={\r\n                  <div>\r\n                    <div>开始时间：{dayjs(epic.start).format(\"YYYY-MM-DD\")}</div>\r\n                    <div>结束时间：{dayjs(epic.end).format(\"YYYY-MM-DD\")}</div>\r\n                  </div>\r\n                }\r\n              />\r\n              <div>\r\n                {tasks\r\n                  ?.filter((task) => task.epicId === epic.id)\r\n                  .map((task) => (\r\n                    <Link\r\n                      to={`/projects/${currentProject?.id}/kanban?editingTaskId=${task.id}`}\r\n                      key={task.id}\r\n                    >\r\n                      {task.name}\r\n                    </Link>\r\n                  ))}\r\n              </div>\r\n            </List.Item>\r\n          )}\r\n        />\r\n        <CreateEpic\r\n          onClose={() => setEpicCreateOpen(false)}\r\n          visible={epicCreateOpen}\r\n        />\r\n      </ScreenContainer>\r\n    )\r\n  }\r\n","import React, { ReactNode } from \"react\"\r\nimport { Draggable, DraggableProps, Droppable, DroppableProps, DroppableProvided, DroppableProvidedProps } from \"react-beautiful-dnd\"\r\n\r\ntype DropProps = Omit<DroppableProps, \"children\"> & { children: ReactNode };\r\n\r\nexport const Drop = ({ children, ...props }: DropProps) => {\r\n  return (\r\n    <Droppable {...props}>\r\n    {(provided) => {\r\n        if (React.isValidElement(children)) {\r\n          return React.cloneElement(children, {\r\n            ...provided.droppableProps,\r\n            ref: provided.innerRef,\r\n            provided,\r\n          });\r\n        }\r\n        return <div />;\r\n      }}\r\n    </Droppable>   \r\n  )\r\n}\r\n\r\ntype DropChildProps = Partial<\r\n  { provided: DroppableProvided } & DroppableProvidedProps\r\n> &\r\n  React.HTMLAttributes<HTMLDivElement>\r\nexport const DropChild = React.forwardRef<HTMLDivElement, DropChildProps>(\r\n  ({ children, ...props }, ref) => (\r\n    <div ref={ref} {...props}>\r\n      {children}\r\n      {props.provided?.placeholder}\r\n    </div>\r\n  )\r\n)\r\n\r\ntype DragProps = Omit<DraggableProps, \"children\"> & { children: ReactNode };\r\nexport const Drag = ({ children, ...props }: DragProps) => {\r\n  return (\r\n    <Draggable {...props}>\r\n      {(provided) => {\r\n        if (React.isValidElement(children)) {\r\n          return React.cloneElement(children, {\r\n            ...provided.draggableProps,\r\n            ...provided.dragHandleProps,\r\n            ref: provided.innerRef,\r\n          })\r\n        }\r\n        return <div />;\r\n      }}\r\n    </Draggable>\r\n  )\r\n}\r\n","import { QueryKey, useMutation, useQuery } from \"react-query\"\r\nimport { Kanban } from \"../types/kanban\"\r\nimport { useHttp } from \"./http\"\r\nimport { useAddConfig, useDeleteConfig, useReorderKanbanConfig } from \"./use-optimistic-options\"\r\n\r\nexport const useKanbans = (param?: Partial<Kanban>) => {\r\n  const client = useHttp()\r\n\r\n  return useQuery<Kanban[]>([\"kanbans\", param], () =>\r\n    client(\"kanbans\", { data: param })\r\n  )\r\n}\r\n\r\nexport const useAddKanban = (queryKey: QueryKey) => {\r\n  const client = useHttp()\r\n\r\n  return useMutation(\r\n    (params: Partial<Kanban>) =>\r\n      client(`kanbans`, {\r\n        data: params,\r\n        method: \"POST\",\r\n      }),\r\n    useAddConfig(queryKey)\r\n  )\r\n}\r\n\r\nexport const useDeleteKanban = (queryKey: QueryKey) => {\r\n  const client = useHttp()\r\n\r\n  return useMutation(\r\n    ({ id }: { id: number }) =>\r\n      client(`kanbans/${id}`, {\r\n        method: \"DELETE\",\r\n      }),\r\n    useDeleteConfig(queryKey)\r\n  )\r\n}\r\n\r\nexport interface SortProps  {\r\n  // 要重新排序的 item\r\n  fromId: number;\r\n  // 目标 item\r\n  referenceId: number;\r\n  // 放在目标 item 的前还是后\r\n  type: \"before\" | \"after\";\r\n  fromKanbanId?: number;\r\n  toKanbanId?: number;\r\n}\r\n\r\nexport const useReorderKanban = (queryKey: QueryKey) => {\r\n  const client = useHttp()\r\n  return useMutation((params: SortProps) => {\r\n    return client(\"kanbans/reorder\", {\r\n      data: params,\r\n      method: \"POST\",\r\n    });\r\n  }, useReorderKanbanConfig(queryKey))\r\n}\r\n","export default __webpack_public_path__ + \"static/media/task.69774797.svg\";","export default __webpack_public_path__ + \"static/media/bug.5d8e8fd5.svg\";","import { useQuery } from \"react-query\"\r\nimport { TaskType } from \"../types/task-type\"\r\nimport { useHttp } from \"./http\"\r\n\r\nexport const useTaskTypes = () => {\r\n  const client = useHttp()\r\n\r\n  return useQuery<TaskType[]>(['taskTypes'], () =>\r\n    client('taskTypes', )\r\n  )\r\n}","import { Card, Input } from \"antd\";\r\nimport { useEffect, useState } from \"react\"\r\nimport { useAddTask } from \"../../utils/task\"\r\nimport { useProjectIdInUrl, useTasksQueryKey } from \"./util\"\r\n\r\nexport const CreateTask = ({ kanbanId }: { kanbanId: number }) => {\r\n  const [name, setName] = useState(\"\")\r\n  const { mutateAsync: addTask } = useAddTask(useTasksQueryKey())\r\n  const projectId = useProjectIdInUrl()\r\n  const [inputMode, setInputMode] = useState(false)\r\n\r\n  const submit = async () => {\r\n    await addTask({ projectId, name, kanbanId })\r\n    setInputMode(false)\r\n    setName(\"\")\r\n  }\r\n\r\n  const toggle = () => setInputMode((mode) => !mode)\r\n\r\n  useEffect(() => {\r\n    if (!inputMode) {\r\n      setName(\"\")\r\n    }\r\n  }, [inputMode])\r\n\r\n  if (!inputMode) {\r\n    return <div onClick={toggle}>+创建事务</div>\r\n  }\r\n\r\n  return (\r\n    <Card>\r\n      <Input\r\n        onBlur={toggle}\r\n        placeholder={\"需要做些什么\"}\r\n        autoFocus={true}\r\n        onPressEnter={submit}\r\n        value={name}\r\n        onChange={(evt) => setName(evt.target.value)}\r\n      />\r\n    </Card>\r\n  );\r\n};","export const Mark = ({name, keyword}: {name: string, keyword: string}) => {\r\n  if(!keyword) {\r\n    return <>{name}</>\r\n  }\r\n  const arr = name.split(keyword)\r\n  return <>\r\n    {\r\n      arr.map((str: string, index: number) => <span key={index}>\r\n        {str}\r\n        {\r\n          index === arr.length - 1 ? null : <span style={{color: '#257AFD'}}>\r\n            {keyword}\r\n            </span>\r\n        }\r\n      </span>)\r\n    }\r\n  </>\r\n\r\n}","import React from 'react'\r\nimport { Kanban } from \"../../types/kanban\"\r\nimport { useTasks } from \"../../utils/task\"\r\nimport { useKanbansQueryKey, useTasksModal, useTasksSearchParams } from './util'\r\nimport taskIcon from '../../assets/task.svg'\r\nimport bugIcon from '../../assets/bug.svg'\r\nimport { useTaskTypes } from '../../utils/task-type'\r\nimport styled from '@emotion/styled'\r\nimport { Button, Card, Dropdown, Menu, Modal } from 'antd'\r\nimport { CreateTask } from './create-task'\r\nimport { Task } from '../../types/task'\r\nimport { Mark } from '../../components/mark'\r\nimport { useDeleteKanban } from '../../utils/kanban'\r\nimport { Row } from '../../components/lib'\r\nimport { Drag, Drop, DropChild } from '../../components/drag-and-drop'\r\n\r\nconst TaskTypeIcon = ({ id }: { id: number }) => {\r\n  const { data: taskTypes } = useTaskTypes()\r\n  const name = taskTypes?.find((taskType) => taskType.id === id)?.name\r\n  if (!name) {\r\n    return null\r\n  }\r\n  return <img alt={\"task-icon\"} src={name === \"task\" ? taskIcon : bugIcon} />\r\n};\r\n\r\nconst TaskCard = ({ task }: { task: Task }) => {\r\n  const { startEdit } = useTasksModal()\r\n  const { name: keyword } = useTasksSearchParams()\r\n  return (\r\n    <Card\r\n      onClick={() => startEdit(task.id)}\r\n      style={{ marginBottom: \"0.5rem\", cursor: \"pointer\" }}\r\n      key={task.id}\r\n    >\r\n      <p>\r\n        <Mark keyword={keyword} name={task.name} />\r\n      </p>\r\n      <TaskTypeIcon id={task.typeId} />\r\n    </Card>\r\n  )\r\n}\r\n\r\nexport const KanbanColumn = React.forwardRef<\r\n  HTMLDivElement,\r\n  { kanban: Kanban }\r\n>(({ kanban, ...props }, ref) => {\r\n  const { data: allTasks } = useTasks(useTasksSearchParams())\r\n  const tasks = allTasks?.filter((task) => task.kanbanId === kanban.id)\r\n  return (\r\n    <Container {...props} ref={ref}>\r\n      <Row between={true}>\r\n        <h3>{kanban.name}</h3>\r\n        <More kanban={kanban} key={kanban.id} />\r\n      </Row>\r\n      <TasksContainer>\r\n        <Drop\r\n          type={\"ROW\"}\r\n          direction={\"vertical\"}\r\n          droppableId={String(kanban.id)}\r\n        >\r\n          <DropChild style={{ minHeight: \"1rem\" }}>\r\n            {tasks?.map((task, taskIndex) => (\r\n              <Drag\r\n                key={task.id}\r\n                index={taskIndex}\r\n                draggableId={\"task\" + task.id}\r\n              >\r\n                <div>\r\n                  <TaskCard key={task.id} task={task} />\r\n                </div>\r\n              </Drag>\r\n            ))}\r\n          </DropChild>\r\n        </Drop>\r\n        <CreateTask kanbanId={kanban.id} />\r\n      </TasksContainer>\r\n    </Container>\r\n  )\r\n})\r\n\r\nconst More = ({ kanban }: { kanban: Kanban }) => {\r\n  const { mutateAsync } = useDeleteKanban(useKanbansQueryKey())\r\n  const startDelete = () => {\r\n    Modal.confirm({\r\n      okText: \"确定\",\r\n      cancelText: \"取消\",\r\n      title: \"确定删除看板吗\",\r\n      onOk() {\r\n        return mutateAsync({ id: kanban.id })\r\n      },\r\n    })\r\n  }\r\n  const overlay = (\r\n    <Menu>\r\n      <Menu.Item>\r\n        <Button type={\"link\"} onClick={startDelete}>\r\n          删除\r\n        </Button>\r\n      </Menu.Item>\r\n    </Menu>\r\n  )\r\n  return (\r\n    <Dropdown overlay={overlay}>\r\n      <Button type={\"link\"}>...</Button>\r\n    </Dropdown>\r\n  )\r\n}\r\n\r\nexport const Container = styled.div`\r\n  min-width: 27rem;\r\n  border-radius: 6px;\r\n  background-color: rgb(244, 245, 247);\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 0.7rem 0.7rem 1rem;\r\n  margin-right: 1.5rem;\r\n`;\r\n\r\nconst TasksContainer = styled.div`\r\n  overflow: scroll;\r\n  flex: 1;\r\n  ::-webkit-scrollbar {\r\n    display: none;\r\n  }\r\n`;","import { Input } from \"antd\"\r\nimport React, { useState } from \"react\"\r\nimport { useAddKanban } from \"../../utils/kanban\"\r\nimport { Container } from \"./kanban-column\"\r\nimport { useKanbansQueryKey, useProjectIdInUrl } from \"./util\"\r\n\r\nexport const CreateKanban = () => {\r\n  const [name, setName] = useState('')\r\n  const projectId = useProjectIdInUrl()\r\n  const { mutateAsync: addKanban } = useAddKanban(useKanbansQueryKey())\r\n\r\n  const submit = async () => {\r\n    await addKanban({ name, projectId })\r\n    setName('')\r\n  }\r\n\r\n  return (\r\n    <Container>\r\n      <Input \r\n        size={'large'} \r\n        placeholder={'新建看板名称'} \r\n        onPressEnter={submit}\r\n        value={name} \r\n        onChange={evt => setName(evt.target.value)}\r\n      />\r\n    </Container>\r\n  )\r\n}","import React from \"react\"\r\nimport { useTaskTypes } from \"../utils/task-type\"\r\nimport { IdSelect } from \"./id-select\"\r\n\r\nexport const TaskTypeSelect = (props: React.ComponentProps<typeof IdSelect>) => {\r\n  const {data: taskTypes } = useTaskTypes()\r\n  return <IdSelect options={taskTypes || []} {...props} />\r\n}","import { Button, Input } from \"antd\"\r\nimport { Row } from \"../../components/lib\"\r\nimport { TaskTypeSelect } from \"../../components/task-type-select\"\r\nimport { UserSelect } from \"../../components/user-select\"\r\nimport { useSetUrlSearchParam } from \"../../utils/url\"\r\nimport { useTasksSearchParams } from \"./util\"\r\n\r\nexport const SearchPanel = () => {\r\n  const searchParams = useTasksSearchParams()\r\n  const setSearchParams = useSetUrlSearchParam()\r\n\r\n  const reset = () => {\r\n    setSearchParams({\r\n      typeId: undefined,\r\n      processorId: undefined,\r\n      tagId: undefined,\r\n      name: undefined\r\n    })\r\n  }\r\n\r\n  return (\r\n    <Row marginBottom={4} gap={true}>\r\n      <Input\r\n        style={{ width: '20rem' }}\r\n        placeholder={'任务名'}\r\n        value={searchParams.name}\r\n        onChange={evt => setSearchParams({ name: evt.target.value })}\r\n      />\r\n      <UserSelect\r\n        defaultOptionName={'经办人'}\r\n        value={searchParams.processorId}\r\n        onChange={value => setSearchParams({ processorId: value })}\r\n      />\r\n      <TaskTypeSelect\r\n        defaultOptionName={'类型'}\r\n        value={searchParams.typeId}\r\n        onChange={value => setSearchParams({ typeId: value })}\r\n      />\r\n      <Button onClick={reset}>清除筛选器</Button>\r\n    </Row>\r\n  )\r\n}","import { useEpics } from \"../utils/epic\";\r\nimport { IdSelect } from \"./id-select\";\r\n\r\nexport const EpicSelect = (props: React.ComponentProps<typeof IdSelect>) => {\r\n  const { data: epics } = useEpics();\r\n  return <IdSelect options={epics || []} {...props} />;\r\n}","import { useForm } from \"antd/es/form/Form\";\r\nimport { useTasksModal, useTasksQueryKey } from \"./util\";\r\nimport { useDeleteTask, useEditTask } from \"../../utils/task\";\r\nimport { Button, Form, Input, Modal } from \"antd\";\r\nimport { UserSelect } from \"../../components/user-select\";\r\nimport { TaskTypeSelect } from \"../../components/task-type-select\";\r\nimport { useEffect } from \"react\";\r\nimport { EpicSelect } from \"../../components/epic-select\";\r\n\r\nconst layout = {\r\n  labelCol: { span: 8 },\r\n  wrapperCol: { span: 16 }\r\n}\r\n\r\nexport const TaskModal = () => {\r\n  const [form] = Form.useForm()\r\n  const { editingTaskId, editingTask, close } = useTasksModal()\r\n  const { mutateAsync: editTask, isLoading: editLoading } = useEditTask(useTasksQueryKey())\r\n  const { mutate: deleteTask } = useDeleteTask(useTasksQueryKey())\r\n\r\n  const onCancel = () => {\r\n    close()\r\n    form.resetFields()\r\n  }\r\n\r\n  const onOk = async () => {\r\n    await editTask({ ...editingTask, ...form.getFieldsValue() })\r\n    close()\r\n  }\r\n\r\n  const startDelete = () => {\r\n    close()\r\n    Modal.confirm({\r\n      okText: '确定',\r\n      cancelText: '取消',\r\n      title: '确定删除任务吗?',\r\n      onOk() {\r\n        return deleteTask({ id: Number(editingTaskId) })\r\n      }\r\n\r\n    })\r\n  }\r\n\r\n  useEffect(() => {\r\n    form.setFieldsValue(editingTask)\r\n  }, [form, editingTask])\r\n\r\n  return (\r\n    <Modal\r\n      forceRender={true}\r\n      onCancel={onCancel}\r\n      onOk={onOk}\r\n      okText={'确认'}\r\n      cancelText={'取消'}\r\n      confirmLoading={editLoading}\r\n      title={'编辑任务'}\r\n      visible={!!editingTaskId}\r\n    >\r\n      <Form {...layout} initialValues={editingTask} form={form}>\r\n        <Form.Item\r\n          label={'任务名'}\r\n          name={'name'}\r\n          rules={[{ required: true, message: '请输入任务名' }]}\r\n        >\r\n          <Input />\r\n        </Form.Item>\r\n        <Form.Item label={\"任务组\"} name={\"epicId\"}>\r\n          <EpicSelect defaultOptionName={\"任务组\"} />\r\n        </Form.Item>\r\n        <Form.Item label={'经办人'} name={'processorId'}>\r\n          <UserSelect defaultOptionName={'经办人'} />\r\n        </Form.Item>\r\n        <Form.Item label={'类型'} name={'typeId'}>\r\n          <TaskTypeSelect />\r\n        </Form.Item>\r\n      </Form>\r\n      <div style={{ textAlign: 'right' }}>\r\n        <Button \r\n          onClick={startDelete} \r\n          style={{ fontSize: '14px' }} \r\n          size={'small'}\r\n        >删除</Button>\r\n      </div>\r\n    </Modal>\r\n  )\r\n}","import styled from '@emotion/styled'\r\nimport { Spin } from 'antd'\r\nimport React, { useCallback } from 'react'\r\nimport { DragDropContext, DropResult } from 'react-beautiful-dnd'\r\nimport { Drag, Drop, DropChild } from '../../components/drag-and-drop'\r\nimport { ScreenContainer } from '../../components/lib'\r\nimport { Profiler } from '../../components/profiler'\r\nimport { useDocumentTitle } from '../../utils'\r\nimport { useKanbans, useReorderKanban } from '../../utils/kanban'\r\nimport { useReorderTask, useTasks } from '../../utils/task'\r\nimport { CreateKanban } from './create-kanban'\r\nimport { KanbanColumn } from './kanban-column'\r\nimport { SearchPanel } from './search-panel'\r\nimport { TaskModal } from './task-modal'\r\nimport { useKanbanSearchParams, useKanbansQueryKey, useProjectInUrl, useTasksQueryKey, useTasksSearchParams } from './util'\r\n\r\nexport const KanbanScreen = () => {\r\n  useDocumentTitle('看板列表')\r\n\r\n  const { data: currentProject } = useProjectInUrl()\r\n  const { data: kanbans, isLoading: kanbanIsLoading } = useKanbans(\r\n    useKanbanSearchParams()\r\n  )\r\n  const { isLoading: taskIsLoading } = useTasks(useTasksSearchParams())\r\n  const isLoading = taskIsLoading || kanbanIsLoading\r\n  \r\n  const onDragEnd = useDragEnd();\r\n  \r\n  return (\r\n    <Profiler id={\"看板页面\"}>\r\n      <DragDropContext onDragEnd={onDragEnd}>\r\n        <ScreenContainer>\r\n          <h1>{currentProject?.name}看板</h1>\r\n          <SearchPanel />\r\n          {isLoading ? (\r\n            <Spin size={\"large\"} />\r\n          ) : (\r\n            <ColumnsContainer>\r\n              <Drop\r\n                type={\"COLUMN\"}\r\n                direction={\"horizontal\"}\r\n                droppableId={\"kanban\"}\r\n              >\r\n                <DropChild style={{ display: \"flex\" }}>\r\n                  {kanbans?.map((kanban, index) => (\r\n                    <Drag\r\n                      key={kanban.id}\r\n                      draggableId={\"kanban\" + kanban.id}\r\n                      index={index}\r\n                    >\r\n                      <KanbanColumn kanban={kanban} key={kanban.id} />\r\n                    </Drag>\r\n                  ))}\r\n                </DropChild>\r\n              </Drop>\r\n              <CreateKanban />\r\n            </ColumnsContainer>\r\n          )}\r\n          <TaskModal />\r\n        </ScreenContainer>\r\n      </DragDropContext>\r\n    </Profiler>\r\n  )\r\n}\r\n\r\nexport const useDragEnd = () => {\r\n  const { data: kanbans } = useKanbans(useKanbanSearchParams());\r\n  const { mutate: reorderKanban } = useReorderKanban(useKanbansQueryKey());\r\n  const { mutate: reorderTask } = useReorderTask(useTasksQueryKey());\r\n  const { data: allTasks = [] } = useTasks(useTasksSearchParams());\r\n  return useCallback(\r\n    ({ source, destination, type }: DropResult) => {\r\n      if (!destination) {\r\n        return\r\n      }\r\n      // 看板排序\r\n      if (type === \"COLUMN\") {\r\n        const fromId = kanbans?.[source.index].id\r\n        const toId = kanbans?.[destination.index].id\r\n        if (!fromId || !toId || fromId === toId) {\r\n          return\r\n        }\r\n        const type = destination.index > source.index ? \"after\" : \"before\";\r\n        reorderKanban({ fromId, referenceId: toId, type })\r\n      }\r\n      if (type === \"ROW\") {\r\n        const fromKanbanId = +source.droppableId\r\n        const toKanbanId = +destination.droppableId\r\n        const fromTask = allTasks.filter(\r\n          (task) => task.kanbanId === fromKanbanId\r\n        )[source.index]\r\n        const toTask = allTasks.filter((task) => task.kanbanId === toKanbanId)[\r\n          destination.index\r\n        ]\r\n        if (fromTask?.id === toTask?.id) {\r\n          return\r\n        }\r\n        reorderTask({\r\n          fromId: fromTask?.id,\r\n          referenceId: toTask?.id,\r\n          fromKanbanId,\r\n          toKanbanId,\r\n          type:\r\n            fromKanbanId === toKanbanId && destination.index > source.index\r\n              ? \"after\"\r\n              : \"before\",\r\n        })\r\n      }\r\n    },\r\n    [kanbans, reorderKanban, allTasks, reorderTask]\r\n  )\r\n}\r\n\r\nexport const ColumnsContainer = styled(\"div\")`\r\n  display: flex;\r\n  overflow-x: scroll;\r\n  flex: 1;\r\n`\r\n\r\n","import styled from '@emotion/styled'\r\nimport { Menu } from 'antd'\r\nimport { Route, Routes, Navigate, useLocation } from 'react-router'\r\nimport { Link } from 'react-router-dom'\r\nimport { EpicScreen } from '../epic'\r\nimport { KanbanScreen } from '../kanban'\r\n\r\nconst useRouteType = () => {\r\n  const units = useLocation().pathname.split('/')\r\n  return units[units.length -1]\r\n}\r\n\r\nexport const ProjectScreen = () => {\r\n  const routeType = useRouteType()\r\n  return (\r\n    <Container>\r\n      <Aside>\r\n        <Menu mode={'inline'} selectedKeys={[routeType]}>\r\n          <Menu.Item key={'kanban'}>\r\n            <Link to={'kanban'}>看板</Link>\r\n          </Menu.Item>\r\n          <Menu.Item key={'epic'}>\r\n            <Link to={'epic'}>任务组</Link>\r\n          </Menu.Item>\r\n        </Menu>\r\n      </Aside>\r\n      <Main>\r\n        <Routes>\r\n          {/*projects/:projectId/kanban*/}\r\n          <Route path={'/kanban'} element={<KanbanScreen />}></Route>\r\n           {/*projects/:projectId/epic*/}\r\n          <Route path={'/epic'} element={<EpicScreen />}></Route>\r\n          <Navigate to={window.location.pathname + '/kanban'} replace={true} />\r\n        </Routes>\r\n      </Main>\r\n    </Container>\r\n  )\r\n}\r\n\r\nconst Aside = styled.aside`\r\n  background-color: rgb(244, 245, 247);\r\n  display: flex;\r\n`\r\n\r\nconst Main = styled.div`\r\n  display: flex;\r\n  box-shadow: -5px 0 5px -5px rgba(0, 0, 0, 0.1);\r\n  overflow: hidden;\r\n`\r\n\r\nconst Container = styled.div`\r\n  display: grid;\r\n  grid-template-columns: 16rem 1fr;\r\n  width: 100%;\r\n`","import React, { useEffect } from 'react'\r\nimport { Button, Drawer, Form, Input, Spin } from 'antd'\r\n// import { projectListActions, selectProjectModalOpen } from './project-list.slice'\r\n// import { useDispatch, useSelector } from 'react-redux'\r\nimport { useProjectModal, useProjectsQueryKey } from './util'\r\nimport { UserSelect } from '../../components/user-select'\r\nimport { useAddProject, useEditProject } from '../../utils/project'\r\nimport { useForm } from 'antd/lib/form/Form'\r\nimport { ErrorBox } from '../../components/lib'\r\nimport styled from '@emotion/styled'\r\n\r\nexport const ProjectModal = () => {\r\n  // 改用context,不用 redux\r\n  // const dispatch = useDispatch()\r\n  // const projectModalOpen = useSelector(selectProjectModalOpen)\r\n\r\n  const { projectModalOpen, close, editingProject, isLoading } = useProjectModal()\r\n  const useMutateProject = editingProject ? useEditProject : useAddProject\r\n\r\n  const { mutateAsync, error, isLoading: mutateLoading } = useMutateProject(\r\n    useProjectsQueryKey()\r\n  )\r\n  const [form] = Form.useForm()\r\n  const onFinish = (values: any) => {\r\n    mutateAsync({ ...editingProject, ...values }).then(() => {\r\n      form.resetFields()\r\n      close()\r\n    })\r\n  }\r\n\r\n  const closeModal = () => {\r\n    form.resetFields()\r\n    close()\r\n  }\r\n\r\n  const title = editingProject ? '编辑项目' : '创建项目'\r\n\r\n  useEffect(() => {\r\n    form.setFieldsValue(editingProject)\r\n  }, [editingProject, form])\r\n\r\n  return (\r\n    <Drawer\r\n      // onClose={() => dispatch(projectListActions.closeProjectModal())}\r\n      onClose={closeModal}\r\n      visible={projectModalOpen}\r\n      width={'100%'}\r\n      forceRender={true}\r\n    >\r\n      <Container>\r\n        {\r\n          isLoading ? <Spin size={'large'} /> :\r\n            <>\r\n              <h1>{title}</h1>\r\n              <ErrorBox error={error}></ErrorBox>\r\n              <Form\r\n                form={form}\r\n                layout={'vertical'}\r\n                style={{ width: '40rem' }}\r\n                onFinish={onFinish}\r\n              >\r\n                <Form.Item\r\n                  label={'名称'}\r\n                  name={'name'}\r\n                  rules={[{ required: true, message: '请输入项目名' }]}\r\n                >\r\n                  <Input placeholder={'请输入项目名称'} />\r\n                </Form.Item>\r\n                <Form.Item\r\n                  label={'部门'}\r\n                  name={'organization'}\r\n                  rules={[{ required: true, message: '请输入部门名' }]}\r\n                >\r\n                  <Input placeholder={'请输入部门名'} />\r\n                </Form.Item>\r\n                <Form.Item\r\n                  label={'负责人'}\r\n                  name={'personId'}\r\n                >\r\n                  <UserSelect defaultOptionName={'负责人'}></UserSelect>\r\n                </Form.Item>\r\n                <Form.Item style={{ textAlign: 'center' }}>\r\n                  <Button\r\n                    loading={mutateLoading}\r\n                    type={'primary'}\r\n                    htmlType={'submit'}\r\n                  >\r\n                    提交\r\n                  </Button>\r\n                </Form.Item>\r\n              </Form>\r\n            </>\r\n        }\r\n      </Container>\r\n    </Drawer>\r\n  )\r\n}\r\n\r\nconst Container = styled.div`\r\n  height: 80vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n`","import styled from '@emotion/styled'\r\nimport { Divider, List, Popover, Typography } from 'antd'\r\n// import { projectListActions } from '../screens/project-list/project-list.slice'\r\nimport { useProjectModal } from '../screens/project-list/util'\r\nimport { useProjects } from '../utils/project'\r\nimport { ButtonNoPadding } from './lib'\r\n\r\n\r\nexport const ProjectPopover = () => {\r\n  // 改用context,不用 redux\r\n  // const dispatch = useDispatch()\r\n  const { open } = useProjectModal()\r\n  const { data: projects, refetch } = useProjects()\r\n  const pinnedProjects = projects?.filter((project) => project.pin)\r\n\r\n  const content = (\r\n    <ContentContainer>\r\n      <Typography.Text type={\"secondary\"}>收藏项目</Typography.Text>\r\n      <List>\r\n        {pinnedProjects?.map((project) => (\r\n          <List.Item key={project.id}>\r\n            <List.Item.Meta title={project.name} />\r\n          </List.Item>\r\n        ))}\r\n      </List>\r\n      <Divider />\r\n      <ButtonNoPadding onClick={open} type={\"link\"}>\r\n        创建项目\r\n      </ButtonNoPadding>\r\n    </ContentContainer>\r\n  )\r\n  return (\r\n    <Popover\r\n      onVisibleChange={() => refetch()}\r\n      placement={\"bottom\"}\r\n      content={content}\r\n    >\r\n      <span>项目</span>\r\n    </Popover>)\r\n}\r\n\r\nconst ContentContainer = styled.div`\r\n  min-width: 30rem;\r\n`\r\n\r\n","import styled from \"@emotion/styled\";\r\nimport { Divider, List, Popover, Typography } from \"antd\";\r\nimport { useUsers } from \"../utils/user\";\r\n\r\nexport const UserPopover = () => {\r\n  const { data: users, refetch } = useUsers();\r\n\r\n  const content = (\r\n    <ContentContainer>\r\n      <Typography.Text type={\"secondary\"}>组员列表</Typography.Text>\r\n      <List>\r\n        {users?.map((user) => (\r\n          <List.Item key={user.id}>\r\n            <List.Item.Meta title={user.name} />\r\n          </List.Item>\r\n        ))}\r\n      </List>\r\n      <Divider />\r\n    </ContentContainer>\r\n  );\r\n\r\n  return (\r\n    <Popover\r\n      onVisibleChange={() => refetch()}\r\n      placement={\"bottom\"}\r\n      content={content}\r\n    >\r\n      <span>组员</span>\r\n    </Popover>\r\n  );\r\n};\r\n\r\nconst ContentContainer = styled.div`\r\n  min-width: 30rem;\r\n`;","import styled from '@emotion/styled';\r\nimport { ButtonNoPadding, Row } from './components/lib';\r\nimport { useAuth } from './context/auth-context';\r\nimport { ProjectListScreen } from './screens/project-list';\r\nimport { ReactComponent as SoftwareLogo } from './assets/software-logo.svg';\r\nimport { Button, Dropdown, Menu } from 'antd';\r\nimport { Navigate, Route, Routes } from \"react-router\";\r\nimport { ProjectScreen } from './screens/project';\r\nimport { resetRoute } from './utils';\r\nimport { ProjectModal } from './screens/project-list/project-modal';\r\nimport { ProjectPopover } from './components/project-popover';\r\nimport { UserPopover } from './components/user-popover';\r\n\r\nexport default  function  AuthenticatedApp () {\r\n  return (\r\n    <Container>\r\n      <PageHeader />\r\n      <Main>\r\n        <Routes>\r\n          <Route path={\"/projects\"} element={<ProjectListScreen />} />\r\n          <Route path={\"/projects/:projectId/*\"} element={<ProjectScreen />} />\r\n          <Navigate to={\"/projects\"} />\r\n        </Routes>\r\n      </Main>\r\n      <ProjectModal />\r\n    </Container>\r\n  )\r\n}\r\n\r\nconst PageHeader = () => {\r\n  return <Header between={true}>\r\n    <HeaderLeft gap={true}>\r\n      <ButtonNoPadding type={'link'} onClick={resetRoute}>\r\n        <SoftwareLogo width={'18rem'} color={'rgb(38, 132, 255'} />\r\n      </ButtonNoPadding>\r\n      <ProjectPopover />\r\n      <UserPopover />\r\n    </HeaderLeft>\r\n    <HeaderRight>\r\n      <User />\r\n    </HeaderRight>\r\n  </Header>\r\n}\r\n\r\nconst User = () => {\r\n  const { logout, user } = useAuth()\r\n  return (\r\n    <Dropdown overlay={\r\n      <Menu>\r\n        <Menu.Item key={'logout'}>\r\n          <Button type={\"link\"} onClick={logout}>登出</Button>\r\n        </Menu.Item>\r\n      </Menu>}>\r\n      <Button type={\"link\"} onClick={e => e.preventDefault()}>\r\n        Hi,{user?.name}\r\n      </Button>\r\n    </Dropdown>\r\n  )\r\n}\r\n\r\nconst Container = styled.div`\r\n  display: grid;\r\n  grid-template-rows: 6rem 1fr;\r\n  height: 100vh;\r\n`\r\n\r\nconst Header = styled(Row)`\r\n  padding: 3.2rem;\r\n  box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.1);\r\n  z-index: 1;\r\n`\r\nconst HeaderLeft = styled(Row)``\r\n\r\nconst HeaderRight = styled.div``\r\n\r\nconst Main = styled.main`\r\n  /* grid-area: main; */\r\n  display: flex;\r\n  overflow: hidden;\r\n`\r\n\r\n"],"sourceRoot":""}